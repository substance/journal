var util = require("./util");

// Document API
// ===================
//
// REST API for creating, updating and deleting documents

module.exports = function(app) {
  var db = app.db;
  var Document = db.models.Document;

  app.get('/api/documents',
    function(req, res, next) {
      var user = req.user;
      Document.findAll(util.out(res, next));
    });

  // Create an empty document
  // -----------
  // 
  // POST /documents
  // 
  // 
  // Response:
  // 
  // Status: 200 OK
  // 
  // {
  //   "id": "3a0f86f", // generated by server
  //   "data": "SUBSTANCE_DOC_JSON",
  //   "created_at": "2015-05-17T15:39:52.403Z",
  //   "updated_at": "2015-05-17T15:39:52.403Z",
  //   "url": "/docuemnt/3a0f86f"
  // }

  app.post('/documents',
    function(req, res, next) {
      var user = req.user;
      Document.create(user.id, util.out(res, next));
    });

  // Update an existing document
  // -----------
  // 
  // PUT /documents/:id
  // 
  // Input:
  // 
  // {
  //   data: "SUBSTANCE_DOC_JSON"
  // }
  // 
  // Response:
  // 
  // Status: 200 OK
  // 
  // {
  //   "id": "3a0f86f", // generated by server
  //   "data": "SUBSTANCE_DOC_JSON",
  //   "created_at": "2015-05-17T15:39:52.403Z",
  //   "updated_at": "2015-05-17T15:39:52.403Z",
  //   "url": "/docuemnt/3a0f86f"
  // }

  app.put('/documents/:id',
    function(req, res, next) {
      var user = req.user;
      var documentId = req.params.id;
      // TODO: In future check JSON if it conforms to a valid Substance document
      Document.update(documentId, req.data, user.id, util.out(res, next));
    });


  // Delete document
  // -----------
  // 
  // Response:
  // 
  // Status: 200 OK

  app.delete('/documents/:id',
    function(req, res, next) {
      var user = req.user;
      var documentId = req.params.id;
      Document.delete(documentId, user.id, util.out(res,next));
    });
};